import React, { useState, useRef } from "react";
import "./FileUploader.css";
import { FaCloudUploadAlt, FaFileAlt, FaCheck } from "react-icons/fa";

export default function FileUploader() {
  const [uploadedFiles, setUploadedFiles] = useState([]);
  const [progress, setProgress] = useState(0);
  const fileInputRef = useRef(null);

  const handleFileClick = () => {
    fileInputRef.current.click();
  };

  const handleFileChange = (event) => {
    const file = event.target.files[0];
    if (file) {
      let fileName = file.name;
      if (fileName.length >= 12) {
        let splitName = fileName.split(".");
        fileName = splitName[0].substring(0, 13) + "... ." + splitName[1];
      }
      uploadFile(fileName);
    }
  };

  const uploadFile = (name) => {
    setProgress(0);
    const interval = setInterval(() => {
      setProgress((prev) => {
        if (prev >= 100) {
          clearInterval(interval);
          setUploadedFiles((prevFiles) => [...prevFiles, { name, size: "1 MB" }]);
          return 100;
        }
        return prev + 10;
      });
    }, 200);
  };

  return (
    <div className="upload-body">
      <div className="wrapper-upload">
        <header>File Uploader</header>
        <div className="upload-box" onClick={handleFileClick}>
          <input
            type="file"
            className="file-input"
            ref={fileInputRef}
            onChange={handleFileChange}
            hidden
          />
          <FaCloudUploadAlt className="upload-icon" />
          <p>Browse File to Upload</p>
        </div>
        <button className="scan-file-btn">Scan File</button>
        <section className="progress-area">
          {progress > 0 && progress < 100 && (
            <div className="progress-container">
              <FaFileAlt />
              <div className="content">
                <div className="details">
                  <span className="name">Uploading...</span>
                  <span className="percent">{progress}%</span>
                </div>
                <div className="progress-bar">
                  <div className="progress" style={{ width: `${progress}%` }}></div>
                </div>
              </div>
            </div>
          )}
        </section>
        <section className="uploaded-area">
          {uploadedFiles.map((file, index) => (
            <div key={index} className="uploaded-row">
              <FaFileAlt />
              <div className="content">
                <span className="name">{file.name} â€¢ Uploaded</span>
                <span className="size">{file.size}</span>
              </div>
              <FaCheck className="check-icon" />
            </div>
          ))}
        </section>
      </div>
    </div>
  );
}
